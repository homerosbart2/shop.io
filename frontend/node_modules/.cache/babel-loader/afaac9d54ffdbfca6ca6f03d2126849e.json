{"ast":null,"code":"import _defineProperty from\"/Users/hcampos/Documents/REACT/shop.io/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/hcampos/Documents/REACT/shop.io/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/hcampos/Documents/REACT/shop.io/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/hcampos/Documents/REACT/shop.io/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/hcampos/Documents/REACT/shop.io/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React,{useEffect,useMemo,useState}from'react';import{Login}from'./components/login/login';import{useStore}from'./stores';import{ProductCard}from'./components/product-card/product-card';import{Navbar}from'./components/navbar/navbar';import{observer}from'mobx-react';import{Button,BUTTON_COLOR}from'./components/button/button';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{StripeContainer}from'./stripe/stripe-container';import{ContextMessage}from'./components/context-message/context-message';import'./shop.scss';export var SHOP_MODE;(function(SHOP_MODE){SHOP_MODE[SHOP_MODE[\"CATALOGE\"]=0]=\"CATALOGE\";SHOP_MODE[SHOP_MODE[\"CART\"]=1]=\"CART\";})(SHOP_MODE||(SHOP_MODE={}));export var Shop=observer(function(){var store=useStore();var productStore=store.productStore;var products=productStore.products;var mappedProducts=productStore.mappedProducts;var userStore=store.userStore;var user=store.userStore.user;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loggedIn=_useState2[0],setLoggedIn=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),shoppingCart=_useState4[0],setShoppingCart=_useState4[1];var _useState5=useState(SHOP_MODE.CATALOGE),_useState6=_slicedToArray(_useState5,2),mode=_useState6[0],setMode=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),showStripeContainer=_useState8[0],setShowStripeContainer=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),contextMessage=_useState10[0],setContextMessage=_useState10[1];useEffect(function(){if(mode===SHOP_MODE.CATALOGE){productStore.index();}},[mode,productStore]);var _useMemo=useMemo(function(){return Object.entries(shoppingCart).reduce(function(countAndTotal,_ref){var _ref2=_slicedToArray(_ref,2),productId=_ref2[0],productCount=_ref2[1];var product=mappedProducts[productId];return{inCartProductCount:countAndTotal.inCartProductCount+productCount,total:product?countAndTotal.total+productCount*product.price:0};},{inCartProductCount:0,total:0});},[shoppingCart,mappedProducts]),inCartProductCount=_useMemo.inCartProductCount,total=_useMemo.total;var handleSignIn=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(user,isNew){var successful,storedShoppingCart;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:successful=false;if(!isNew){_context.next=7;break;}_context.next=4;return userStore.create(user);case 4:successful=_context.sent;_context.next=10;break;case 7:_context.next=9;return userStore.show(user.email);case 9:successful=_context.sent;case 10:if(successful){setLoggedIn(true);setMode(SHOP_MODE.CATALOGE);localStorage.setItem('loggedInUserEmail',user.email);storedShoppingCart=localStorage.getItem(\"shoppingCart::\".concat(user.email));if(storedShoppingCart){setShoppingCart(JSON.parse(storedShoppingCart));}}else{handleFail('Your email is not registered, please sign up.');}case 11:case\"end\":return _context.stop();}}},_callee);}));return function handleSignIn(_x,_x2){return _ref3.apply(this,arguments);};}();var handleSignOut=function handleSignOut(){setLoggedIn(false);setShoppingCart({});localStorage.removeItem('loggedInUserEmail');};var handleAddToCart=function handleAddToCart(product){setShoppingCart(function(shoppingCart){var productCount=(shoppingCart[product.id]||0)+1;var canAdd=productCount<=product.quantity;var newShoppingCart=canAdd?_objectSpread(_objectSpread({},shoppingCart),{},_defineProperty({},product.id,productCount)):shoppingCart;if(!canAdd){handleFail('Not enough stock.');}if(user){localStorage.setItem(\"shoppingCart::\".concat(user.email),JSON.stringify(newShoppingCart));}return newShoppingCart;});};var handleRemoveFromCart=function handleRemoveFromCart(productId){setShoppingCart(function(shoppingCart){var productCount=(shoppingCart[productId]||0)-1;var newShoppingCart=_objectSpread({},shoppingCart);if(productCount===0){delete newShoppingCart[productId];}else if(productCount>0){newShoppingCart[productId]=productCount;}if(user){localStorage.setItem(\"shoppingCart::\".concat(user.email),JSON.stringify(newShoppingCart));}return newShoppingCart;});};var handleModeChange=function handleModeChange(mode){setMode(mode);};var handleProceedButtonClick=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setShowStripeContainer(true);case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function handleProceedButtonClick(){return _ref4.apply(this,arguments);};}();var handleCancelButtonClick=function handleCancelButtonClick(){setShowStripeContainer(false);};var handlePaySuccess=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!user){_context3.next=8;break;}_context3.next=3;return store.orderStore.create({shoppingCart:shoppingCart,user:user});case 3:if(!_context3.sent){_context3.next=7;break;}setShoppingCart({});setShowStripeContainer(false);localStorage.setItem(\"shoppingCart::\".concat(user.email),JSON.stringify({}));case 7:;case 8:case\"end\":return _context3.stop();}}},_callee3);}));return function handlePaySuccess(){return _ref5.apply(this,arguments);};}();var handleFail=function handleFail(message){setContextMessage(message);};var handleMessageClear=function handleMessageClear(){setContextMessage('');};return/*#__PURE__*/_jsxs(\"div\",{className:\"shop\",children:[/*#__PURE__*/_jsx(Login,{loggedIn:loggedIn,onSignIn:handleSignIn,onFail:handleFail}),/*#__PURE__*/_jsxs(\"div\",{className:\"manager \".concat(loggedIn?'shown':''),children:[/*#__PURE__*/_jsx(Navbar,{shopMode:mode,inCartProductCount:inCartProductCount,onShopModeChange:handleModeChange,onSignOut:handleSignOut}),/*#__PURE__*/_jsx(\"div\",{className:\"catalogue\",children:products.map(function(product){return/*#__PURE__*/_jsx(ProductCard,{product:product,onAddToCart:handleAddToCart},\"product-\".concat(product.id));})}),/*#__PURE__*/_jsx(\"div\",{className:\"cart \".concat(mode===SHOP_MODE.CART?'shown':''),children:/*#__PURE__*/_jsxs(\"div\",{className:\"summary\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"table\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"headers\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header\"}),/*#__PURE__*/_jsx(\"div\",{className:\"header\",children:\"Quantity\"}),/*#__PURE__*/_jsx(\"div\",{className:\"header\",children:\"Image\"}),/*#__PURE__*/_jsx(\"div\",{className:\"header\",children:\"Name\"}),/*#__PURE__*/_jsx(\"div\",{className:\"header\",children:\"Subtotal\"})]}),products.length>0&&Object.entries(shoppingCart).map(function(_ref6){var _ref7=_slicedToArray(_ref6,2),productId=_ref7[0],productCount=_ref7[1];var product=mappedProducts[productId];return/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cell\",children:/*#__PURE__*/_jsx(\"div\",{className:\"remove-formatter\",onClick:function onClick(){return handleRemoveFromCart(+productId);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"minus\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"cell\",children:/*#__PURE__*/_jsx(\"div\",{className:\"quantity-formatter\",children:productCount})}),/*#__PURE__*/_jsx(\"div\",{className:\"cell\",children:/*#__PURE__*/_jsx(\"div\",{className:\"image-formatter\",style:{backgroundColor:product===null||product===void 0?void 0:product.color}})}),/*#__PURE__*/_jsx(\"div\",{className:\"cell\",children:/*#__PURE__*/_jsx(\"div\",{className:\"name-formatter\",children:product===null||product===void 0?void 0:product.name})}),/*#__PURE__*/_jsx(\"div\",{className:\"cell\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"price-formatter\",children:[\"$\",(((product===null||product===void 0?void 0:product.price)||0)*productCount/100).toFixed(2)]})})]},\"row-\".concat(productId));})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"total\",children:[/*#__PURE__*/_jsx(Button,{color:BUTTON_COLOR.GREEN,shown:total>0&&!showStripeContainer,onClick:handleProceedButtonClick,children:\"Proceed\"}),/*#__PURE__*/_jsx(StripeContainer,{amount:total,shown:showStripeContainer,onCancelButtonClick:handleCancelButtonClick,onPaySuccess:handlePaySuccess}),/*#__PURE__*/_jsxs(\"div\",{className:\"amount\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text\",children:\"Total\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"number\",children:[\"$\",(total/100).toFixed(2)]})]})]})]})})]}),/*#__PURE__*/_jsx(ContextMessage,{message:contextMessage,onMessageClear:handleMessageClear})]});});","map":{"version":3,"sources":["/Users/hcampos/Documents/REACT/shop.io/frontend/src/shop.tsx"],"names":["React","useEffect","useMemo","useState","Login","useStore","ProductCard","Navbar","observer","Button","BUTTON_COLOR","FontAwesomeIcon","StripeContainer","ContextMessage","SHOP_MODE","Shop","store","productStore","products","mappedProducts","userStore","user","loggedIn","setLoggedIn","shoppingCart","setShoppingCart","CATALOGE","mode","setMode","showStripeContainer","setShowStripeContainer","contextMessage","setContextMessage","index","Object","entries","reduce","countAndTotal","productId","productCount","product","inCartProductCount","total","price","handleSignIn","isNew","successful","create","show","email","localStorage","setItem","storedShoppingCart","getItem","JSON","parse","handleFail","handleSignOut","removeItem","handleAddToCart","id","canAdd","quantity","newShoppingCart","stringify","handleRemoveFromCart","handleModeChange","handleProceedButtonClick","handleCancelButtonClick","handlePaySuccess","orderStore","message","handleMessageClear","map","CART","length","backgroundColor","color","name","toFixed","GREEN"],"mappings":"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","sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\nimport { Login } from './components/login/login';\nimport { User } from './types/user';\nimport { useStore } from './stores';\nimport { ProductCard } from './components/product-card/product-card';\nimport { Navbar } from './components/navbar/navbar';\nimport { Product } from './types/product';\nimport { observer } from 'mobx-react';\nimport { Button, BUTTON_COLOR } from './components/button/button';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { ShoppingCart } from './types/shopping-cart';\nimport { StripeContainer } from './stripe/stripe-container';\nimport { ContextMessage } from './components/context-message/context-message';\n\nimport './shop.scss';\n\nexport enum SHOP_MODE {\n    CATALOGE,\n    CART,\n}\n\nexport const Shop = observer(() => {\n    const store = useStore();\n    const productStore = store.productStore;\n    const products = productStore.products;\n    const mappedProducts = productStore.mappedProducts;\n    const userStore = store.userStore;\n    const user = store.userStore.user;\n\n    const [loggedIn, setLoggedIn] = useState<boolean>(false);\n    const [shoppingCart, setShoppingCart] = useState<ShoppingCart>({});\n    const [mode, setMode] = useState<SHOP_MODE>(SHOP_MODE.CATALOGE);\n    const [showStripeContainer, setShowStripeContainer] = useState<boolean>(false);\n    const [contextMessage, setContextMessage] = useState<string>('');\n\n    useEffect(\n        () => {\n            if (mode === SHOP_MODE.CATALOGE) {\n                productStore.index();\n            }\n        },\n        [mode, productStore],\n    );\n\n    const { inCartProductCount, total } = useMemo(\n        () => {\n            return Object.entries(shoppingCart).reduce(\n                (countAndTotal, [productId, productCount]) => {\n                    const product = mappedProducts[productId];\n\n                    return {\n                        inCartProductCount: countAndTotal.inCartProductCount + productCount,\n                        total: product\n                            ? countAndTotal.total + (productCount * product.price)\n                            : 0,\n                    };\n                },\n                {\n                    inCartProductCount: 0,\n                    total: 0,\n                },\n            );\n        },\n        [shoppingCart, mappedProducts],\n    );\n\n    const handleSignIn = async (user: Partial<User> & Pick<User, 'email'>, isNew: boolean) => {\n        let successful = false;\n\n        if (isNew) {\n            successful = await userStore.create(user as User);\n        } else {\n            successful = await userStore.show(user.email);\n        }\n\n        if (successful) {\n            setLoggedIn(true);\n            setMode(SHOP_MODE.CATALOGE);\n            localStorage.setItem('loggedInUserEmail', user.email);\n            const storedShoppingCart = localStorage.getItem(`shoppingCart::${user.email}`);\n            if (storedShoppingCart) {\n                setShoppingCart(JSON.parse(storedShoppingCart));\n            }\n        } else {\n            handleFail('Your email is not registered, please sign up.')\n        }\n    };\n\n    const handleSignOut = () => {\n        setLoggedIn(false);\n        setShoppingCart({});\n        localStorage.removeItem('loggedInUserEmail');\n    };\n\n    const handleAddToCart = (product: Product) => {\n        setShoppingCart(shoppingCart => {\n            const productCount = (shoppingCart[product.id] || 0) + 1;\n\n            const canAdd = productCount <= product.quantity;\n\n            const newShoppingCart = canAdd\n                ? {\n                    ...shoppingCart,\n                    [product.id]: productCount,\n                } : shoppingCart;\n\n            if (!canAdd) {\n                handleFail('Not enough stock.')\n            }\n\n            if (user) {\n                localStorage.setItem(`shoppingCart::${user.email}`, JSON.stringify(newShoppingCart));\n            }\n\n            return newShoppingCart;\n        });\n    };\n\n    const handleRemoveFromCart = (productId: Product['id']) => {\n        setShoppingCart(shoppingCart => {\n            const productCount = (shoppingCart[productId] || 0) - 1;\n\n            const newShoppingCart = {\n                ...shoppingCart,\n            };\n\n            if (productCount === 0) {\n                delete newShoppingCart[productId];\n            } else if (productCount > 0) {\n                newShoppingCart[productId] = productCount;\n            }\n\n            if (user) {\n                localStorage.setItem(`shoppingCart::${user.email}`, JSON.stringify(newShoppingCart));\n            }\n\n            return newShoppingCart;\n        });\n    };\n\n    const handleModeChange = (mode: SHOP_MODE) => {\n        setMode(mode);\n    };\n\n    const handleProceedButtonClick = async () => {\n        setShowStripeContainer(true);\n    };\n\n    const handleCancelButtonClick = () => {\n        setShowStripeContainer(false);\n    };\n\n    const handlePaySuccess = async () => {\n        if (user) {\n            if (await store.orderStore.create({\n                shoppingCart,\n                user,\n            })) {\n                setShoppingCart({});\n                setShowStripeContainer(false);\n                localStorage.setItem(`shoppingCart::${user.email}`, JSON.stringify({}));\n            };\n        }\n    };\n\n    const handleFail = (message: string) => {\n        setContextMessage(message);\n    };\n\n    const handleMessageClear = () => {\n        setContextMessage('');\n    }\n\n    return (\n        <div className=\"shop\">\n            <Login\n                loggedIn={loggedIn}\n                onSignIn={handleSignIn}\n                onFail={handleFail}\n            />\n            <div className={`manager ${loggedIn ? 'shown' : ''}`}>\n                <Navbar\n                    shopMode={mode}\n                    inCartProductCount={inCartProductCount}\n                    onShopModeChange={handleModeChange}\n                    onSignOut={handleSignOut}\n                />\n                <div className=\"catalogue\">\n                    {products.map(product => (\n                        <ProductCard\n                            key={`product-${product.id}`}\n                            product={product}\n                            onAddToCart={handleAddToCart}\n                        />\n                    ))}\n                </div>\n                <div className={`cart ${mode === SHOP_MODE.CART ? 'shown' : ''}`}>\n                    <div className=\"summary\">\n                        <div className=\"table\">\n                            <div className=\"headers\">\n                                <div className=\"header\"/>\n                                <div className=\"header\">\n                                    Quantity\n                                </div>\n                                <div className=\"header\">\n                                    Image\n                                </div>\n                                <div className=\"header\">\n                                    Name\n                                </div>\n                                <div className=\"header\">\n                                    Subtotal\n                                </div>\n                            </div>\n                            {products.length > 0 && Object.entries(shoppingCart).map(([productId, productCount]) => {\n                                const product = mappedProducts[productId];\n\n                                return (\n                                    <div key={`row-${productId}`} className=\"row\">\n                                        <div className=\"cell\">\n                                            <div\n                                                className=\"remove-formatter\"\n                                                onClick={() => handleRemoveFromCart(+productId)}\n                                            >\n                                                <FontAwesomeIcon icon=\"minus\"/>\n                                            </div>\n                                        </div>\n                                        <div className=\"cell\">\n                                            <div className=\"quantity-formatter\">\n                                                {productCount}\n                                            </div>\n                                        </div>\n                                        <div className=\"cell\">\n                                            <div className=\"image-formatter\" style={{ backgroundColor: product?.color }}/>\n                                        </div>\n                                        <div className=\"cell\">\n                                            <div className=\"name-formatter\">\n                                                {product?.name}\n                                            </div>\n                                        </div>\n                                        <div className=\"cell\">\n                                            <div className=\"price-formatter\">\n                                                ${(((product?.price || 0) * productCount) / 100).toFixed(2)}\n                                            </div>\n                                        </div>\n                                    </div>\n                                )\n                            })}\n                        </div>\n                        <div className=\"total\">\n                            <Button\n                                color={BUTTON_COLOR.GREEN}\n                                shown={total > 0 && !showStripeContainer}\n                                onClick={handleProceedButtonClick}\n                            >\n                                Proceed\n                            </Button>\n                            <StripeContainer\n                                amount={total}\n                                shown={showStripeContainer}\n                                onCancelButtonClick={handleCancelButtonClick}\n                                onPaySuccess={handlePaySuccess}\n                            />\n                            <div className=\"amount\">\n                                <div className=\"text\">\n                                    Total\n                                </div>\n                                <div className=\"number\">\n                                ${(total / 100).toFixed(2)}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <ContextMessage message={contextMessage} onMessageClear={handleMessageClear}/>\n        </div>\n    );\n});\n"]},"metadata":{},"sourceType":"module"}